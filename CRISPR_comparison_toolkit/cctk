#!/usr/bin/env python3

import sys
import argparse

# cctk imports
from cctkpkg import CRISPRtree
from cctkpkg import CRISPRdiff
from cctkpkg import evolve_array
from cctkpkg import minced2arrays
from cctkpkg import blast2arrays
from cctkpkg import CRISPRcasfinder2arrays

description = """
Find CRISPR arrays in assemblies:
  blast         Find CRISPR arrays with user-provided repeat(s) using BLASTn
  ccf           Find CRISPR arrays using CRISPRCasFinder
  minced        Find CRISPR arrays using minced

Analyze the differences between CRISPR arrays:
  CRISPRtree    Perform a maximum parsimony analysis on CRISPR arrays
  CRISPRdiff    Produce a CRISPRdiff plot comparing CRISPR arrays

"""

def parse_args(args=None):
	cli = argparse.ArgumentParser(
		formatter_class=argparse.RawDescriptionHelpFormatter)

	subparsers = cli.add_subparsers(
		title="Available commands in the CRISPR comparison toolkit",
		dest="command",
		description=description,
		help=argparse.SUPPRESS)

	# CRISPR array finding tools
	
	# blast2arrays.py CLI options
	blast = subparsers.add_parser(
		'blast',
		help="Find CRISPR arrays with the provided repeat using BLASTn."
		)
	blast = blast2arrays.build_parser(blast)

	# CRISPRcasfinder2arrays.py CLI options
	crcasfinder = subparsers.add_parser(
		'ccf',
		help="Find CRISPR arrays using CRISPRCasFinder."
		)
	crcasfinder = CRISPRcasfinder2arrays.build_parser(crcasfinder)

	# minced2arrays.py CLI options
	minced = subparsers.add_parser(
		'minced',
		help="Find CRISPR arrays using minced."
		)
	minced = minced2arrays.build_parser(minced)
	
	# CRISPRtree.py CLI options
	tree = subparsers.add_parser(
		'CRISPRtree',
		help="Perform a maximum parsimony analysis on CRISPR arrays.")
	tree = CRISPRtree.build_parser(tree)

	# CRISPRdiff.py CLI options
	diff = subparsers.add_parser(
		'CRISPRdiff',
		help="Produce a CRISPRdiff plot comparing CRISPR arrays.")
	diff = CRISPRdiff.build_parser(diff)

	# evolve_array.py CLI options
	evolve = subparsers.add_parser(
		'evolve',
		help="Perform in silico evolution of CRISPR arrays."
		)
	evolve = evolve_array.build_parser(evolve)


	args = cli.parse_args(args)

	return args


def main():


	if len(sys.argv) == 1:
		parse_args(['--help'])
	else:
		args = parse_args()

	if args.command == "evolve":
		evolve_array.main(args)
	elif args.command == "CRISPRtree":
		CRISPRtree.main(args)
	elif args.command == "CRISPRdiff":
		CRISPRdiff.main(args)
	elif args.command == "blast":
		blast2arrays.main(args)
	elif args.command == "CRISPRCasFinder":
		CRISPRcasfinder2arrays.main(args)
	elif args.command == "minced":
		minced2arrays.main(args)
	elif args.command == "CRISPRtree":
		CRISPRtree.main(args)
	elif args.command == "CRISPRtree":
		CRISPRtree.main(args)


# CRISPRcasfinder2arrays
# CRISPRdiff
# CRISPRspacers2network
# CRtree_constrained
# minced2arrays
# narbl2arrays
# process_CRISPR_blast
# Process_CRISPR_cas_finder_out
# reps2arrays

if __name__ == '__main__':
	main()
